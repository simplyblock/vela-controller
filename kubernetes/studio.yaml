apiVersion: v1
kind: Pod
metadata:
  name: vela-studio
  namespace: vela-services
  labels:
    app.kubernetes.io/name: vela-studio
spec:
  containers:
    - name: vela-studio
      image: simplyblock/vela-studio:latest
      imagePullPolicy: IfNotPresent
      ports:
        - name: vela-studio-http
          containerPort: 3000
          protocol: TCP
      envFrom:
        - configMapRef:
            name: vela-studio-config
      livenessProbe:
        httpGet:
          path: /
          port: vela-studio-http
        periodSeconds: 5
        timeoutSeconds: 5
        failureThreshold: 3
      readinessProbe:
        httpGet:
          path: /
          port: vela-studio-http
        initialDelaySeconds: 20
  restartPolicy: Always
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: vela-studio-config
  namespace: vela-
data:
  NEXT_PUBLIC_API_URL: 'http://localhost:8080/api'
  NEXT_PUBLIC_GOTRUE_URL: 'http://localhost:8000/auth'
  NEXT_PUBLIC_IS_PLATFORM: 'true'
  PUBLIC_PLATFORM: 'vela'
  VELA_PLATFORM_GOTRUE_URL: 'http://localhost:8000/auth'
  VELA_PLATFORM_URL: 'http://localhost:8000/vela'
  PLATFORM_PG_META_URL: 'http://localhost:8080/meta'
  AUTH_JWT_SECRET: 'secret'
  SUPABASE_ANON_KEY: 'UpNVntn3cDxHJpq99YMc1T1AQgQpc8kfYTuRgBiYa15BLrx8etQoXz3gZv1/u2oq'
  SUPABASE_PUBLIC_URL: 'http://localhost:8000'
  LOGFLARE_PRIVATE_ACCESS_TOKEN: 'your-super-secret-and-long-logflare-key-private'
  IS_THROTTLED: 'false'
---
apiVersion: v1
kind: Service
metadata:
  name: vela-studio-service
  namespace: vela-services
spec:
  selector:
    app.kubernetes.io/name: vela-studio
  ports:
    - name: vela-studio-http
      port: 3000
      targetPort: 3000
      protocol: TCP
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: vela-controller-ingress
  namespace: vela-services
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$1
spec:
  ingressClassName: nginx
  rules:
    - http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: vela-studio-service
                port:
                  number: 3000
